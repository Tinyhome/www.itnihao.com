<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>itnihao opsadmin blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="//cdnjs.bootcss.com/ajax/libs/twitter-bootstrap/2.3.1/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
    </style>
    <link href="//cdnjs.bootcss.com/ajax/libs/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//cdnjs.bootcss.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
    <![endif]-->
    <!--ie6-->
    <!--[if lte IE 6]> <script src="/static/js/letskillie6.zh_CN.pack.js"></script><![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
                    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
                                   <link rel="shortcut icon" href="../assets/ico/favicon.png">
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="#">opsadmin</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="/">首页</a></li>
              <li><a href="/opsadmin/opsadmin-detail.html">opsadmin开源运维平台</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">系统运维 <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="#">linux基础</a></li>
                  <li><a href="#">linux进阶</a></li>
                  <li><a href="#">linux高级</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">web服务</li>
                  <li><a href="#">nginx</a></li>
                  <li><a href="#">apache</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">缓存</li>
                  <li><a href="#">squid</a></li>
                  <li><a href="#">varnish</a></li>                  
                  <li class="divider"></li>
                  <li class="nav-header">其他</li>
                  <li><a href="#">监控</a></li>
                  <li><a href="#">调优</a></li>
                </ul>
              </li>
              <li><a href="http://itnihao.blog.51cto.com/"  target="_blank">我的51cto博客</a></li>
              <li><a href="#about">关于</a></li>
              <li><a href="#contact">联系</a></li>
            </ul>
            <form class="navbar-form pull-right">
              <input class="span2" type="text" placeholder="用户">
              <input class="span2" type="password" placeholder="密码">
              <button type="submit" class="btn">登录</button>
            </form>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">

      <!-- Main hero unit for a primary marketing message or call to action -->
      <div >
<p>
    1.发送邮件并带附件 
</p>
<pre style="width:99%;height:46px">
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                <span style="color:#ff0000">echo</span><span style="color:#0000ff"> &quot;test&quot;|<span style="color:#ff0000">mail -s</span> &quot;itnihaotest&quot;<span style="color:#ff0000"> -a</span> /etc/passwd itnihao@qq.com </span>
            </p>
        </li>
    </ol>
</pre>
<p>
    注意：此命令在mailx-8.1.1（rhel5.X）版本上不能运行，在mailx-12.2(rhel6.X)可以运行
</p>
<p>
    2.加到 /etc/bashrc，将用户的操作命令记录系统日志syslog，添加完毕source /etc/bashrc
</p>
<pre style="width:99%;height:46px">
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                <span class="attribute">PROMPT_COMMAND</span>=<span class="attribute-value">&#39;{ msg=$(history 1 | { read x y; echo $y; });user=$(whoami); logger $(date &quot;+%Y-%m-%d %H:%M:%S&quot;):$user:$msg:$(who am i); }&#39;</span>
            </p>
        </li>
    </ol>
</pre>
<p>
     下面的命令也有相同作用
</p>
<pre style="width:99%;height:48px">
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                <span class="attribute">PROMPT_COMMAND</span>=<span class="attribute-value">&#39;history -a &gt;(tee -a ~/.bash_history | logger -t &quot;$USER[$$] $SSH_CONNECTION&quot;)&#39;</span>
            </p>
        </li>
    </ol>
</pre>
<p>
     3.mysql备份指定字符集
</p>
<pre style="width:99%;height:35px">
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                mysqldump -uroot <span class="attribute">--default-character-set</span>=<span class="attribute-value">utf8</span>  -p vw<span class="tag">&gt;</span>vw.sql  
            </p>
        </li>
    </ol>
</pre>
<p>
     4.踢出系统中已经登录的用户
</p>
<pre style="width:99%;height:46px">
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                pkill -kill -t pts/0 
            </p>
        </li>
    </ol>
</pre>
<p>
     5.安装dz提示无法连接到/etc/mysql.sock
</p>
<ol class="dp-xml list-paddingleft-2">
    <li class="alt">
        <p>
            <span style="border-bottom:medium none;border-left:medium none;margin:0px;color:black;border-top:medium none;border-right:medium none;padding:0px;">Can&#39;t connect to local MySQL server through socket &#39;/etc/mysql.sock&#39; (2)  </span>
        </p>
    </li>
    <li>
        <p>
            <span style="border-bottom:medium none;border-left:medium none;margin:0px;color:black;border-top:medium none;border-right:medium none;padding:0px;">ln -s /tmp/mysql.sock /etc/mysql.sock </span>
        </p>
    </li>
</ol>
<p>
    6.mysql密码漏洞链接
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                http://www.sunchangming.com/blog/?<span class="attribute">p</span>=<span class="attribute-value">4260</span>
            </p>
        </li>
        <li>
            <p>
                http://seclists.org/oss-sec/2012/q2/493 
            </p>
        </li>
        <li class="alt">
            <p>
                http://www.freebuf.com/vuls/3815.html 
            </p>
        </li>
        <li>
            <p>
                https://github.com/rapid7/metasploit-framework/blob/master/modules/auxiliary/scanner/mysql/mysql_authbypass_hashdump.rb
            </p>
        </li>
    </ol>
</pre>
<p>
    <span style="background-color:#f7f7f7;font-family:&#39;courier new&#39;, monospace;font-size:12px">7.sudo命令的执行 用来排除不允许执行的命令</span>
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                root    <span class="attribute">ALL</span>=(ALL)       ALL admin   <span class="attribute">ALL</span>=(root)      NOPASSWD: ALL admin   <span class="attribute">ALL</span>=(root)      NOPASSWD: !/sbin/fdisk,!/sbin/iptables
            </p>
        </li>
    </ol>
</pre>
<p>
     8.清除dmesg信息
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                dmesg -c 
            </p>
        </li>
    </ol>
</pre>
<p>
    9查看apache404的资源
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                awk &#39;$9 ~ 404{print $7}&#39; /usr/local/apache2/logs/access_log|sort -nr|uniq 
            </p>
        </li>
    </ol>
</pre>
<p>
    10硬盘相关测试
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                hdparm -t /dev/sda              读取速度测试
            </p>
        </li>
        <li class="alt">
            <p>
                hdparm  -I /dev/sda|grep Serial 序列号
            </p>
        </li>
    </ol>
</pre>
<p>
    11清除僵尸进程
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                `ps -ef | grep &#39;<span class="tag">&lt;</span><span class="tag-name">defunct</span><span class="tag">&gt;</span>&#39;|grep -v grep |awk &#39;{print $2,$3}&#39;|sed &quot;s/^/kill -9
            </p>
        </li>
        <li class="alt">
            <p>
                 /g&quot;` 
            </p>
        </li>
    </ol>
</pre>
<p>
    12查看tcp连接数
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                netstat -n|grep ^tcp|awk &#39;{print $NF}&#39;|sort -nr|uniq -c <br />
            </p>
        </li>
    </ol>
</pre>
<p>
    13. 查找替换文件
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                find /tmp  -name &quot;*.*&quot; -print|xargs -i sed -i &quot;s/aaa/bbb/g&quot; {} 
            </p>
        </li>
    </ol>
</pre>
<p>
    14.tcpdump抓vlan数据包
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                tcpdump -n -q -i eth0 vlan and src host 10.10.10.10 and dst host 20.20.20.20 and tcp[20:4]=0x47455420 -XX -s 250  
            </p>
        </li>
        <li class="alt">
            <p>
                tcpdump -n -q -i eth2 tcp[20:4]=0x47455420 -XX -s 0
            </p>
        </li>
    </ol>
    <p>
        15.ip138查ip地址接口<br />
        http://ip138.com/ips1388.asp?
    </p>
</pre>
<p>
    nagios插件
</p>
<pre>
    <p>
        centreon使用中文
    </p>
</pre>
<p>
    <a href="http://code.google.com/p/cacti-nagios/downloads/list">http://code.google.com/p/cacti-nagios/downloads/list</a><br />
    16解压rpm包<br />
    rpm2cpio httpd-2.2.3-45.el5.x86_64.rpm | cpio -div<br />
    17xen  loop设备不够用<br />
    <a style="color:#666666;text-decoration:none;font-family:&#39;microsoft yahei&#39;;font-size:20px;line-height:30px;text-align:left;background-color:#ffffff;" href="http://blog.csdn.net/jackxinxu2100/article/details/4957508">Xen虚拟机Linux下的loop设备增加  </a><a href="http://blog.csdn.net/jackxinxu2100/article/details/4957508"><span style="font-size:9px;">http://blog.csdn.net/jackxinxu2100/article/details/4957508<br />
            <br />
        </span></a>
</p>
<pre>
    <a href="http://blog.csdn.net/jackxinxu2100/article/details/4957508"><span style="font-size:9px;">18 mysql分页显示</span></a>
</pre>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                mysql<span class="tag">&gt;</span>pager less; 设置分页显示变量 
            </p>
        </li>
        <li>
            <p>
                mysql<span class="tag">&gt;</span>show processlist\g; 接\g参数 
            </p>
        </li>
        <li class="alt">
            <p>
                mysql<span class="tag">&gt;</span>nopager; 取消分页显示 
            </p>
        </li>
    </ol>
</pre>
<p>
    119查看tcp连接数状态信息
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                netstat -an|awk &#39;/^tcp/ {++S[$NF]} END {for(a in S) {printf &quot;%11-s %s\n&quot;, a,S[a]}}&#39; 
            </p>
        </li>
    </ol>
</pre>
<p>
    20unrar
</p>
<p>
    http://www.rarlab.com/rar/rarlinux-x64-4.2.0.tar.gz 
</p>
<p>
    21批量删除海量文件
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                rsync --delete-before -a -H -v --progress --stats 空文件夹/  目标文件夹/ 
            </p>
        </li>
    </ol>
</pre>
<p>
    22给某个终端用户发送消息
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                #write admin pts/2  #admin用户所在的终端未pts/2 
            </p>
        </li>
        <li>
            <p>
                输入文件内容，对方显示 
            </p>
        </li>
    </ol>
</pre>
<p>
     23linux挂载windows共享
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                mount -o <span class="attribute">username</span>=<span class="attribute-value">123</span>,<span class="attribute">password</span>=<span class="attribute-value">123</span> //172.18.0.10/file /mnt/file 
            </p>
        </li>
    </ol>
</pre>
<p>
     24vim取消选择亮色
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                不退出VIM时，取消高亮一直生效:set nohlsearch只是取消上次查找内容的高亮，下次查找会再次高亮:nohlsearch 
            </p>
        </li>
    </ol>
</pre>
<p>
     25 ntfs-3g
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                http://www.tuxera.com/community/ntfs-3g-download/ 
            </p>
        </li>
    </ol>
</pre>
<p>
     26  centos5.5  ext4的支持
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                yum -y install e4fsprogs 
            </p>
        </li>
    </ol>
</pre>
<p>
     27 获取本机ip地址
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                ip a|awk -F &quot;inet|/&quot;  &#39;/inet.*brd/ {print $2}&#39; 
            </p>
        </li>
        <li class="alt">
            <p>
                ifconfig |awk -F &#39;inet addr:|Bcast:&#39;  &#39;/Bcast:/{print $2}&#39;
            </p>
        </li>
    </ol>
</pre>
<p>
     http://www.iqm.cn
</p>
<p>
    28 改变终端提示符颜色
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                export <span class="attribute">PS1</span>=<span class="attribute-value">&#39;[\[$(tput bold)$(tput setb 4)$(tput setaf 1)\]\u@\h ~ \A \[$(tput bold)$(tput setb 4)$(tput setaf 2)\]\w\[$(tput bold)$(tput setb 4)$(tput setaf 7)\]]\[$(tput bold)$(tput setb 4)$(tput setaf 6)\]\#\$\[$(tput bold)$(tput setb 4)$(tput setaf 7)\]&#39;</span>
            </p>
        </li>
    </ol>
</pre>
<p>
    29 记录用户操作日志
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                export <span class="attribute">PROMPT_COMMAND</span>=<span class="attribute-value">&#39;{ msg=$(history 1 | { read x y; echo $y; });logger &quot;[hostname- $(hostname)]&quot;: &quot;[euid=$(whoami)]&quot;:$(who am i):[`pwd`]:&quot;$msg&quot;; }&#39;</span>
            </p>
        </li>
    </ol>
</pre>
<p>
     30.windows git
</p>
<p>
    <a target="_blank" href="http://code.google.com/p/tortoisegit/" style="color:#006699;font-family:helvetica, tahoma, arial, sans-serif;font-size:14px;line-height:25.1875px;background-color:#f7f7f7;">http://code.google.com/p/tortoisegit/</a><span style="font-family:helvetica, tahoma, arial, sans-serif;font-size:14px;line-height:25.1875px;background-color:#f7f7f7;"></span>
</p>
<p>
    <a href="https://code.google.com/p/msysgit/" target="_blank">https://code.google.com/p/msysgit/</a>
</p>
<p>
    31软件下载地址
</p>
<p>
    resin
</p>
<p>
    <a href="http://www.caucho.com/download/download-archive/">http://www.caucho.com/download/download-archive/</a>
</p>
<p>
    <a href="http://bgp.he.net" target="_blank">http://bgp.he.net</a>
</p>
<p>
    <a href="http://www.freelancer.com/">http://www.freelancer.com</a>   国外外赚的一个网站，留着以后看看
</p>
<p>
    32 查看被删除的，但进程在使用中的文件
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                lsof | awk &#39;$9~/^\// &amp;&amp; $7 <span class="tag">&gt;</span> 10000000&#39;|grep deleted 
            </p>
        </li>
    </ol>
</pre>
<p>
    <a href="http://support.ipmonitor.com/mibs/IANA-LANGUAGE-MIB/item.aspx">http://support.ipmonitor.com/mibs/IANA-LANGUAGE-MIB/item.aspx</a>
</p>
<p>
    33 子网掩码计算工具
</p>
<p>
    <br />
</p>
<pre>
    <ol class="dp-xml list-paddingleft-2">
        <li class="alt">
            <p>
                http://mirrors.sohu.com/ubuntu/pool/universe/n/netmask/ 
            </p>
        </li>
    </ol>
</pre>
<p>
    34 新浪ip地址解析接口
</p>
<p>
    http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=json&amp;ip=123.124.2.85
</p>
<p>
    35.rpm官方资料
</p>
<p>
    <a href="http://docs.fedoraproject.org/en-US/Fedora_Draft_Documentation/0.1/html/RPM_Guide/index.html">http://docs.fedoraproject.org/en-US/Fedora_Draft_Documentation/0.1/html/RPM_Guide/index.html</a>
</p>
<p>
    <br />
</p>
<p>
    <br />
</p>
<p>
    zabbix资料
</p>
<p>
    <a href="http://blog.sina.com.cn/s/blog_704836f40101g0fb.html">http://blog.sina.com.cn/s/blog_704836f40101g0fb.html</a>
</p>
<p>
    <a href="http://wenku.baidu.com/view/2491ee0a4a7302768e993968.html">http://wenku.baidu.com/view/2491ee0a4a7302768e993968.html</a>
</p>
<p>
    <br />
</p>
<p>
    <br />
</p>
<p>
    35.mysql删除bing-log
</p>
<pre class="brush:as3;toolbar:false;">
    PURGE MASTER LOGS TO 'mysql-bin.010';
PURGE MASTER LOGS BEFORE '20013-04-02 22:46:26';
PURGE MASTER LOGS BEFORE DATE_SUB(CURRENT_DATE, INTERVAL 3 DAY);
</pre>
<p>
    <br />
</p>
<p>
    36 netmask ip地址计算工具
</p>
<p>
    <strong style="color:#599100;font-family:simsun;font-size:14px;line-height:21px;background-color:#dceccc;"><span style="color:#ff0000;word-wrap:normal;word-break:normal;"><a href="http://mirrors.sohu.com/ubuntu/pool/universe/n/netmask/netmask_2.3.12.tar.gz" style="color:#599100;font-family:simsun;font-size:14px;line-height:21px;background-color:#dceccc;">http://mirrors.sohu.com/ubuntu/pool/universe/n/netmask/netmask_2.3.12.tar.gz</a></span></strong>
</p>
<p>
    <strong style="color:#599100;font-family:simsun;font-size:14px;line-height:21px;background-color:#dceccc;">37 查找僵尸进程</strong>
</p>
<p>
    <strong style="color:#599100;font-family:simsun;font-size:14px;line-height:21px;background-color:#dceccc;"><a href="http://inbank2012.blog.51cto.com/6302802/1094008">http://inbank2012.blog.51cto.com/6302802/1094008</a></strong>
</p>
<p>
    38 linux下乱码文件的删除
</p>
<pre class="brush:bash;toolbar:false;">
    shell#ls -i     #找出i节点后删除
15899955 ?=x^??????S?E??
shell#find  ./  -inum 15899955  -print  -exec  rm {} -rf \;
</pre>
<p>
    <br />
</p>
<p>
    <br />
</p>
<p>
    <br />
</p>
<p>
    <br />
</p>
      </div>


      <hr>

      <footer>
        <p>&copy; itnihao 2013</p>
      </footer>

    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="//cdnjs.bootcss.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="//cdnjs.bootcss.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
    <!--baidu-->
    <div style='display:none;'>
      <script type="text/javascript">
           var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
          document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F42ad7929ee2f4d8cd2606f8d0546daa2' type='text/javascript'%3E%3C/script%3E"));
      </script>
    </div>
    <!--baidu-->    

  </body>
</html>
